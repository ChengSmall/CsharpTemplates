# CSPACK包格式

### 简介

CSPACK包是可储存任意数据的包协议，无压缩协议；全称为数据流存储包“ChengStreamPack”

### **字节头**

6字节头数据

```
0x43, 0x53, 0x50, 0x41, 0x43, 0x4B
```

意为`CSPACK`字符串

### 数据项与数据流

字节头之后紧接着依次读取数据项，直至读取到终结符

每一项如下格式：

---

1. 第一个字节: 1byte

	该值表示 0 时意为终结符，将终止查找数据项

	非 0 时表示有数据，并且该字节的值代表该项的路径字符数量，范围在[1,255]

2. 路径字符串

	通过第一个字节获取路径字符串的字符数量，从下一个字节开始读取路径字符串

3. 数据块

	从字符串结尾的后一位开始，从此开始处读取8个字节表示一个64位整数 length，表示数据块长度

	length 读取完毕后，在下一位开始的位置作为起始点，长度为 length 的数据块，代表此次数据块的内容

	在此数据块末尾的后一位，继续重新读取下一项数据

---

### 数据读取格式

- 64位整数值读取

	8个字节序列，从第一个字节开始，依次为1-8位，9-16位...一直到第八个字节，表示56-64位，
	最终合并为一个整数

- 字符串读取

	字符串的字符数量参数需要额外获取，从前向后依次读取字符，组合为一个字符串

	每一个字符包含2个字节，前一个字节表示前8位，后一个字节表示后8位，
	拼接为16位整型，表示为UTF-16的Unicode字符

### 兼容性

#### 项数据路径字符限制

- 项数据路径采用文件管理器的格式，使用'\'或者'/'作为路径分隔符

- 分隔符之间表示每一级的路径名，分隔符不能有多个连续或纯空格分割

- 路径名不能包含的字符：

	`"` `<` `>` `?` `|` `*` `:`

	各类系统控制符，例如换行符，制表符等

	所有不可打印的字符

	不在UTF-16的Unicode字符中收录的字符

- 路径的结尾不能有路径分隔符

- 路径的首尾不能有多余的空格

- 路径字符串不能为 `"\\"` 和 `".."`

#### 项数据的唯一性

- 包数据中的项路径不能有相同的路径，判断相同的依据：

	- 字符串长度相同，每一个字符的Unicode码位完全一致

	- 对于路径分隔符'/'和'\'，将会视为同一个字符

	- 当路径字符出现字母时，不会区分字母的大小写，也就是说'A'和'a'被视为同一个字符；但即使如此，在写入数据包和显示渲染时，仍会区分大小写

- CSP包不会将存在相同项路径的包视为严格遵循标准的包
