# 序列化标准

## 序列化对象顺序

### 读取类型 1byte

第一步，读取 1 个字节，视为类型字节，获取前4bit以判断数据类型

### 空值

如果类型为空值，则直接表示为一个空值

### 布尔值

获取类型字节的第5个bit位，1 == true; 0 == false;

### 32位整数

向后读取4字节，第一个字节是1-8bit，第二个字节代表9-16bit...以此组成4字节整数

### 32位单精度浮点数

向后读取4字节，第一个字节是1-8bit，第二个字节代表9-16bit...以此组成4字节，表示为浮点数

### 64位整数

向后读取8字节，第一个字节是1-8bit，第二个字节代表9-16bit...以此组成8字节整数

### 64位双精度浮点数

向后读取8字节，第一个字节是1-8bit，第二个字节代表9-16bit...以此组成8字节，表示为浮点数

### 字符串

向后读取4字节，第一个字节是1-8bit，第二个字节代表9-16bit...依次拼凑为31bit（忽略最后一位），组成一个范围在[1,2147483647]的整数，表示为字符串长度

继续向后读取，按字符数读取，每一个字符为2个字节

第一个字节是1-8bit，第二个字节代表9-16bit，组成的整数代表一个字符值，读取相应长度的字符数，以此表示字符串

### 集合

集合元素，依次读取

Loop:

向后读取一个字节，并查看该字节最后一位（第8位bit），如果是0，表示集合读取到结尾，读取完毕

如果是1，表示存在集合元素:

继续判断该字节，获取前4bit，组成参数类型值

根据类型读取相应数据

继续读取下一个元素 => Loop

### 键值对

依次读取键值对元素

Loop:

向后读取一个字节，并查看该字节最后一位（第8位bit），如果是0，表示键值对读取到结尾，读取完毕

如果是1，表示存在集合元素:

继续判断该字节，获取前4bit，组成参数类型值，记为 type

向后读取2字节，第一个字节是1-8bit，第二个字节代表9-16bit，组成一个整数，代表key的字符串长度

每一个字符为2个字节，按长度读取key的值

继续向后读取，根据 type 读取值

继续读取下一个元素 => Loop

---

### 数据类型映射表

DynVariable 对象类型和值的映射表 由4个bit构成

空值 empty = 0

32位整数 int32 = 0001 = 1 

64位整数 int64 = 0010 = 2

32位单精度浮点数 float = 0101 = 5

64位双精度浮点数 double = 0110 = 6

表示true或false的布尔值 boolean = 0100 = 4

字符串 string = 0111 = 7

集合，可存储其它包括自身对象 list = 1001 = 9

键值对，字符串为键（字符数量不超过65535），可存储其它包括自身对象 dictionary = 1010 = 10

---